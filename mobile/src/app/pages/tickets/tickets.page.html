<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-back-button slot="start" defaultHref="/home"></ion-back-button>
    <ion-title>๐๏ธ ุชุฐุงูุฑู</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refreshTickets()" [disabled]="loading">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>ุฌุงุฑู ุชุญููู ุงูุชุฐุงูุฑ...</p>
  </div>

  <!-- No Auth State -->
  <div *ngIf="!authService.isAuthenticated()" class="auth-prompt">
    <ion-card>
      <ion-card-header>
        <ion-card-title>ุชุณุฌูู ุงูุฏุฎูู ูุทููุจ</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ูุนุฑุถ ุชุฐุงูุฑู</p>
        <ion-button expand="block" [routerLink]="['/login']">
          <ion-icon name="log-in-outline" slot="start"></ion-icon>
          ุชุณุฌูู ุงูุฏุฎูู
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- No Tickets State -->
  <div *ngIf="authService.isAuthenticated() && !loading && tickets.length === 0" class="no-tickets">
    <ion-card>
      <ion-card-content class="text-center">
        <div class="empty-icon">๐ซ</div>
        <h2>ูุง ุชูุฌุฏ ุชุฐุงูุฑ ุจุนุฏ</h2>
        <p>ูู ุชุญุตู ุนูู ุฃู ุชุฐุงูุฑ ูุงูุตูุจ ุญุชู ุงูุขู. ุงุดุชุฑู ููุชุฌุงุช ููุญุตูู ุนูู ุชุฐุงูุฑ ูุฌุงููุฉ!</p>
        <ion-button expand="block" [routerLink]="['/products']">
          <ion-icon name="storefront-outline" slot="start"></ion-icon>
          ุชุตูุญ ุงูููุชุฌุงุช
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Tickets Content -->
  <div *ngIf="authService.isAuthenticated() && !loading && tickets.length > 0">
    
    <!-- Statistics Cards -->
    <ion-grid class="stats-section">
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card golden">
            <ion-card-content>
              <div class="stat-icon">๐ฅ</div>
              <div class="stat-number">{{ getGoldenTicketsCount() }}</div>
              <div class="stat-label">ุฐูุจู</div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card class="stat-card silver">
            <ion-card-content>
              <div class="stat-icon">๐ฅ</div>
              <div class="stat-number">{{ getSilverTicketsCount() }}</div>
              <div class="stat-label">ูุถู</div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card bronze">
            <ion-card-content>
              <div class="stat-icon">๐ฅ</div>
              <div class="stat-number">{{ getBronzeTicketsCount() }}</div>
              <div class="stat-label">ุจุฑููุฒู</div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card class="stat-card active">
            <ion-card-content>
              <div class="stat-icon">โ</div>
              <div class="stat-number">{{ getActiveTicketsCount() }}</div>
              <div class="stat-label">ูุดุท</div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Filters -->
    <ion-card class="filters-card">
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="12" size-md="4">
              <ion-item>
                <ion-select 
                  [(ngModel)]="selectedCategory" 
                  (ionChange)="onCategoryChange()"
                  placeholder="ูู ุงููุฆุงุช">
                  <ion-select-option value="all">ูู ุงููุฆุงุช</ion-select-option>
                  <ion-select-option value="golden">๐ฅ ุฐูุจู</ion-select-option>
                  <ion-select-option value="silver">๐ฅ ูุถู</ion-select-option>
                  <ion-select-option value="bronze">๐ฅ ุจุฑููุฒู</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-md="4">
              <ion-item>
                <ion-input 
                  [(ngModel)]="searchTerm" 
                  (ionInput)="onSearchChange()"
                  placeholder="ุจุญุซ ุจุฑูู ุงูุชุฐูุฑุฉ..."
                  clearInput="true">
                </ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-md="4">
              <ion-item>
                <ion-checkbox 
                  [(ngModel)]="showUsedTickets" 
                  (ionChange)="onUsedTicketsToggle()">
                </ion-checkbox>
                <ion-label class="ion-margin-start">ุนุฑุถ ุงููุณุชุฎุฏูุฉ</ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
        
        <!-- Results Info -->
        <div class="results-info">
          <ion-text color="medium">
            ุนุฑุถ {{ (currentPage - 1) * ticketsPerPage + 1 }} ุฅูู 
            {{ getMinValue(currentPage * ticketsPerPage, filteredTickets.length) }} ูู 
            {{ filteredTickets.length }} ุชุฐูุฑุฉ 
            (ุตูุญุฉ {{ currentPage }} ูู {{ totalPages }})
          </ion-text>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Tickets List -->
    <div *ngFor="let ticket of paginatedTickets" class="ticket-item">
      <ion-card>
        <ion-card-header>
          <ion-card-title>
            <div class="ticket-header">
              <span class="category-badge" [ngClass]="'category-' + ticket.category">
                {{ getCategoryIcon(ticket.category) }} {{ getCategoryText(ticket.category) }}
              </span>
              <span class="ticket-status" [ngClass]="ticket.is_used ? 'status-used' : 'status-active'">
                {{ ticket.is_used ? '๐ฏ ูุณุชุฎุฏูุฉ' : 'โ ูุดุทุฉ' }}
              </span>
            </div>
          </ion-card-title>
          <ion-card-subtitle>
            ุฑูู ุงูุชุฐูุฑุฉ: {{ ticket.ticket_number }}
          </ion-card-subtitle>
        </ion-card-header>
        
        <ion-card-content>
          <!-- Product Information -->
          <div class="product-info" *ngIf="ticket.product">
            <h4>ูุนูููุงุช ุงูููุชุฌ</h4>
            <ion-item lines="none">
              <ion-icon name="cube-outline" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h3>{{ ticket.product.name }}</h3>
                <p>{{ formatPrice(ticket.product.price) }} ุฏ.ุน</p>
              </ion-label>
            </ion-item>
          </div>

          <!-- Ticket Details -->
          <div class="ticket-details">
            <ion-item lines="none" *ngIf="ticket.generated_at">
              <ion-icon name="calendar-outline" slot="start" color="medium"></ion-icon>
              <ion-label>
                <h3>ุชุงุฑูุฎ ุงูุฅูุดุงุก</h3>
                <p>{{ formatDate(ticket.generated_at) }}</p>
              </ion-label>
            </ion-item>
            
            <ion-item lines="none" *ngIf="ticket.expires_at">
              <ion-icon name="time-outline" slot="start" color="warning"></ion-icon>
              <ion-label>
                <h3>ุชุงุฑูุฎ ุงูุงูุชูุงุก</h3>
                <p>{{ formatDate(ticket.expires_at) }}</p>
              </ion-label>
            </ion-item>
            
            <ion-item lines="none" *ngIf="ticket.verification_code">
              <ion-icon name="shield-checkmark-outline" slot="start" color="success"></ion-icon>
              <ion-label>
                <h3>ุฑูุฒ ุงูุชุญูู</h3>
                <p class="verification-code">{{ ticket.verification_code }}</p>
              </ion-label>
            </ion-item>
          </div>

          <!-- Purchase Order Info -->
          <div class="order-info" *ngIf="ticket.order">
            <h4>ูุนูููุงุช ุงูุทูุจ</h4>
            <ion-item lines="none">
              <ion-icon name="receipt-outline" slot="start" color="tertiary"></ion-icon>
              <ion-label>
                <h3>ุฅุฌูุงูู ุงูุทูุจ</h3>
                <p>{{ formatPrice(ticket.order.total_price) }} ุฏ.ุน</p>
              </ion-label>
            </ion-item>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Pagination Controls -->
    <div *ngIf="totalPages > 1" class="pagination-controls">
      <ion-button 
        fill="outline" 
        size="small"
        [disabled]="currentPage === 1"
        (click)="previousPage()">
        <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
      </ion-button>
      
      <div class="page-numbers">
        <ion-button 
          *ngFor="let page of getPageNumbers()"
          [fill]="page === currentPage ? 'solid' : 'clear'"
          size="small"
          (click)="goToPage(page)">
          {{ page }}
        </ion-button>
      </div>
      
      <ion-button 
        fill="outline" 
        size="small"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()">
        <ion-icon name="chevron-forward-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

  </div>
</ion-content>
