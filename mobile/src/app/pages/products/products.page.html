<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-back-button slot="start" defaultHref="/home"></ion-back-button>
    <ion-title>๐ ุงูููุชุฌุงุช</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refreshProducts()" [disabled]="loading">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</p>
  </div>

  <!-- Category Filter (if category passed from home) -->
  <ion-card *ngIf="selectedCategoryName" class="category-banner">
    <ion-card-content>
      <div class="category-header">
        <ion-icon name="trophy-outline" color="primary"></ion-icon>
        <div>
          <h2>{{ selectedCategoryName }}</h2>
          <p>{{ products.length }} ููุชุฌ ูุชุงุญ</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- No Products State -->
  <div *ngIf="!loading && products.length === 0" class="no-products">
    <ion-card>
      <ion-card-content class="text-center">
        <div class="empty-icon">๐</div>
        <h2>ูุง ุชูุฌุฏ ููุชุฌุงุช</h2>
        <p>ูุง ุชูุฌุฏ ููุชุฌุงุช ูุชุงุญุฉ ุญุงููุงู ูู ูุฐู ุงููุฆุฉ</p>
        <ion-button expand="block" [routerLink]="['/home']">
          <ion-icon name="home-outline" slot="start"></ion-icon>
          ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Products Grid -->
  <div *ngIf="!loading && products.length > 0" class="products-container">
    <div *ngFor="let product of products" class="product-item">
      <ion-card>
        <!-- Product Header -->
        <ion-card-header>
          <div class="product-header">
            <ion-card-title>{{ product.name }}</ion-card-title>
            <ion-chip [color]="getCategoryColor(product.ticket_category)">
              {{ getCategoryIcon(product.ticket_category) }} {{ getCategoryText(product.ticket_category) }}
            </ion-chip>
          </div>
          <ion-card-subtitle>{{ product.description }}</ion-card-subtitle>
        </ion-card-header>

        <!-- Product Content -->
        <ion-card-content>
          <!-- Price and Tickets Info -->
          <div class="product-details">
            <div class="price-info">
              <div class="price">{{ formatPrice(product.price) }} ุฏ.ุน</div>
              <div class="tickets-info">
                <ion-icon name="ticket-outline" color="primary"></ion-icon>
                {{ product.tickets_per_purchase || 1 }} ุชุฐูุฑุฉ ูุฌุงููุฉ
              </div>
            </div>
          </div>

          <!-- Product Features -->
          <div class="features" *ngIf="product.ticket_category">
            <h4>ูููุฒุงุช ุงูุชุฐูุฑุฉ:</h4>
            <div class="feature-list">
              <div class="feature-item">
                <ion-icon name="time-outline" color="medium"></ion-icon>
                <span>ุตุงูุญุฉ ููุฏุฉ {{ getCategoryExpiry(product.ticket_category) }}</span>
              </div>
              <div class="feature-item">
                <ion-icon name="shield-checkmark-outline" color="success"></ion-icon>
                <span>ุฑูุฒ ุชุญูู ุขูู</span>
              </div>
              <div class="feature-item">
                <ion-icon name="trophy-outline" color="warning"></ion-icon>
                <span>ูุคููุฉ ููุณุญูุจุงุช</span>
              </div>
            </div>
          </div>

          <!-- Purchase Section -->
          <div class="purchase-section">
            <div class="quantity-selector">
              <ion-item>
                <ion-label>ุงููููุฉ:</ion-label>
                <ion-select [(ngModel)]="quantities[product.id]" placeholder="1">
                  <ion-select-option value="1">1</ion-select-option>
                  <ion-select-option value="2">2</ion-select-option>
                  <ion-select-option value="3">3</ion-select-option>
                  <ion-select-option value="5">5</ion-select-option>
                  <ion-select-option value="10">10</ion-select-option>
                </ion-select>
              </ion-item>
            </div>

            <div class="total-calculation" *ngIf="quantities[product.id] > 1">
              <div class="total-row">
                <span>ุงูุฅุฌูุงูู:</span>
                <span class="total-price">{{ formatPrice(product.price * quantities[product.id]) }} ุฏ.ุน</span>
              </div>
              <div class="tickets-row">
                <span>ุงูุชุฐุงูุฑ:</span>
                <span class="total-tickets">{{ (product.tickets_per_purchase || 1) * quantities[product.id] }} ุชุฐูุฑุฉ</span>
              </div>
            </div>

            <ion-button 
              expand="block" 
              size="large"
              [disabled]="purchasing[product.id] || !authService.isAuthenticated()"
              (click)="purchaseProduct(product)">
              
              <ion-spinner name="crescent" *ngIf="purchasing[product.id]"></ion-spinner>
              <span *ngIf="!purchasing[product.id]">
                <ion-icon name="cart-outline" slot="start"></ion-icon>
                ุดุฑุงุก ุงูุขู
              </span>
            </ion-button>

            <!-- Login Required Message -->
            <div *ngIf="!authService.isAuthenticated()" class="login-required">
              <ion-text color="medium">
                <p>ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ููุดุฑุงุก</p>
              </ion-text>
              <ion-button fill="outline" expand="block" [routerLink]="['/login']">
                <ion-icon name="log-in-outline" slot="start"></ion-icon>
                ุชุณุฌูู ุงูุฏุฎูู
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Floating Action Button for Cart -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="authService.isAuthenticated()">
    <ion-fab-button [routerLink]="['/tickets']">
      <ion-icon name="ticket-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
