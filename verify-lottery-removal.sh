#!/bin/bash

# üéØ Buy Lottery Ticket Removal - Final Verification Script
# This script verifies that all "Buy Lottery Ticket" functionality has been removed

echo "üîç VERIFYING BUY LOTTERY TICKET REMOVAL"
echo "========================================"

# Check for any remaining "Buy Lottery" references in frontend
echo "üì± Checking Frontend for 'Buy Lottery' references..."
FRONTEND_MATCHES=$(grep -r "Buy.*Lottery\|Lottery.*Buy\|buyLotteryTicket" frontend/src/ --include="*.html" --include="*.ts" 2>/dev/null | wc -l)

if [ $FRONTEND_MATCHES -eq 0 ]; then
    echo "‚úÖ No 'Buy Lottery' references found in frontend"
else
    echo "‚ùå Found $FRONTEND_MATCHES 'Buy Lottery' references in frontend:"
    grep -r "Buy.*Lottery\|Lottery.*Buy\|buyLotteryTicket" frontend/src/ --include="*.html" --include="*.ts"
fi

# Check frontend build
echo ""
echo "üèóÔ∏è Testing Frontend Build..."
cd frontend
BUILD_RESULT=$(npm run build 2>&1)
if echo "$BUILD_RESULT" | grep -q "Application bundle generation complete"; then
    echo "‚úÖ Frontend builds successfully"
else
    echo "‚ùå Frontend build failed"
fi
cd ..

# Check backend tests
echo ""
echo "üß™ Running Backend Tests..."
cd backend
TEST_RESULT=$(php artisan test 2>&1)
if echo "$TEST_RESULT" | grep -q "Tests:.*passed"; then
    PASSED_TESTS=$(echo "$TEST_RESULT" | grep -o "[0-9]* passed" | head -1)
    echo "‚úÖ Backend tests: $PASSED_TESTS"
else
    echo "‚ùå Backend tests failed"
fi
cd ..

# Check for JavaScript alerts in frontend
echo ""
echo "üö® Checking for remaining JavaScript alerts..."
ALERT_MATCHES=$(grep -r "alert(" frontend/src/ --include="*.ts" --include="*.js" 2>/dev/null | wc -l)

if [ $ALERT_MATCHES -eq 0 ]; then
    echo "‚úÖ No JavaScript alerts found (all replaced with notifications)"
else
    echo "‚ö†Ô∏è Found $ALERT_MATCHES JavaScript alerts remaining:"
    grep -r "alert(" frontend/src/ --include="*.ts" --include="*.js"
fi

# Summary
echo ""
echo "üìä VERIFICATION SUMMARY"
echo "======================="
echo "Frontend 'Buy Lottery' references: $FRONTEND_MATCHES"
echo "Frontend build: $([ $? -eq 0 ] && echo "‚úÖ PASS" || echo "‚ùå FAIL")"
echo "Backend tests: $(echo "$TEST_RESULT" | grep -q "passed" && echo "‚úÖ PASS" || echo "‚ùå FAIL")"
echo "JavaScript alerts: $ALERT_MATCHES remaining"

if [ $FRONTEND_MATCHES -eq 0 ] && [ $ALERT_MATCHES -eq 0 ]; then
    echo ""
    echo "üéâ VERIFICATION COMPLETE: All 'Buy Lottery Ticket' functionality successfully removed!"
    echo "‚úÖ System ready with streamlined UI"
else
    echo ""
    echo "‚ö†Ô∏è VERIFICATION INCOMPLETE: Some issues found above"
fi
